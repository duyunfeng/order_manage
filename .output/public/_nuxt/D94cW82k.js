import{d as z,G as C,z as v,T as J,N as R,J as j,O as Q,r as u,a as H,o as K,D as i,g as $,A as m,C as n,E as g,B as d,y as X,P as Z,Q as ee,R as te,M as S,_ as le}from"./BxW7P6YO.js";import{B as ae,a as ie}from"./DmTcGZZt.js";import{B as se}from"./DTLkWoKO.js";import{_ as ne}from"./Bl7Kk6Fe.js";import{g as oe,d as ce,u as T,a as pe}from"./CkUg4rBD.js";import{u as ue}from"./C0__V_YE.js";const de=z({__name:"ImagePreviewer",props:{urlList:{},initialIndex:{},visible:{type:Boolean}},emits:["close"],setup(G,{emit:h}){const k=h;function p(){k("close")}return(o,f)=>(v(),C(J,{to:"body"},[o.visible?(v(),C(j(Q),{key:0,"url-list":o.urlList,"z-index":3e3,"initial-index":o.initialIndex,"hide-on-click-modal":!0,onClose:p},null,8,["url-list","initial-index"])):R("",!0)]))}}),re={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"16px"}},me=["src","onClick"],ge=z({__name:"index",setup(G){const h=u({id:"",name:"",status:"",createdAt:""}),k=[{prop:"id",label:"商品ID",placeholder:"请输入商品ID",type:"input"},{prop:"name",label:"商品名称",placeholder:"请输入商品名称",type:"input"},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"全部",value:""},{label:"上架",value:"on"},{label:"下架",value:"off"}]},{prop:"createdAt",label:"创建时间",type:"date",placeholder:"请选择创建时间",valueFormat:"YYYY-MM-DD"}],p=u(!1),o=u(!1),f=u({name:"",price:null,spec_length:null,spec_width:null,spec_height:null,spec_unit:"cm",spec_color:"",image:"",imageFile:null,factories:[],_id:void 0}),B=[{label:"工厂一",value:"f1"},{label:"工厂二",value:"f2"},{label:"工厂三",value:"f3"}],M=[{prop:"name",label:"商品名称",type:"input",placeholder:"请输入商品名称",rules:[{required:!0,message:"必填"}]},{prop:"price",label:"价格($)",type:"input",placeholder:"请输入价格",rules:[{required:!0,message:"必填"}]},{prop:"spec_length",label:"长度",type:"input",placeholder:"请输入长度"},{prop:"spec_width",label:"宽度",type:"input",placeholder:"请输入宽度"},{prop:"spec_height",label:"高度",type:"input",placeholder:"请输入高度"},{prop:"spec_unit",label:"单位",type:"input",placeholder:"请输入单位",rules:[],default:"cm"},{prop:"spec_color",label:"颜色",type:"input",placeholder:"请输入颜色"},{prop:"image",label:"商品图片",type:"custom-upload",placeholder:"请上传商品图片"},{prop:"factories",label:"生产工厂",type:"factory-select",placeholder:"请选择工厂",options:B}],P=[{prop:"id",label:"商品ID",width:200},{prop:"name",label:"名称",width:180},{prop:"spec",label:"规格",minWidth:200,slot:!0},{prop:"image",label:"图片",width:120,slot:!0},{prop:"price",label:"价格($)",width:100},{prop:"factories",label:"生产工厂",minWidth:180,slot:!0},{prop:"status",label:"上架状态",width:100,slot:!0},{prop:"createdAt",label:"创建时间",width:160},{prop:"updatedAt",label:"更新时间",width:160},{prop:"actions",label:"操作",minWidth:240,getActions:(e,t)=>[{label:"查看",onClick:a=>F(a)},{label:"编辑",type:"primary",onClick:a=>E(a)},{label:e.status==="on"?"下架":"上架",type:e.status==="on"?"warning":"success",onClick:a=>N(a,a.status==="on"?"off":"on")},{label:"删除",type:"danger",onClick:a=>D(a)}]}],b=u([]),{$axios:he}=H(),x=u(!1),A=u([]),I=u(0);K(async()=>{await _()});async function _(){const e=await oe(h.value);b.value=e.data.data.map(t=>({...t,spec:JSON.parse(t.spec),factories:t.factories.map(a=>a.factory)}))||[]}function L(e){_().then(()=>{b.value=b.value.filter(t=>{const a=!e.id||t.id.includes(e.id),r=!e.name||t.name.includes(e.name),s=!e.status||t.status===e.status,l=!e.createdAt||t.createdAt.startsWith(e.createdAt);return a&&r&&s&&l})})}function U(){h.value={id:"",name:"",status:"",createdAt:""},_()}function F(e){alert("查看详情："+e.name)}function O(e){var t;o.value=!0,f.value={name:e.name,price:e.price,spec_length:e.spec.length,spec_width:e.spec.width,spec_height:e.spec.height,spec_color:e.spec.color,spec_unit:e.spec.unit||"cm",image:e.image,imageFile:null,factories:((t=e.factories)==null?void 0:t.map(a=>a.id))||[],_id:e.id},p.value=!0}function D(e){te.confirm(`确定要删除商品：${e.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ce(e.id).then(()=>{_()})})}function N(e,t){T(e.id,{...e,status:t}).then(()=>{_()})}function W(e){router.push({path:"/factories",query:{id:e.id}})}function Y(){o.value=!1,V(),p.value=!0}function E(e){var t;o.value=!0,f.value={name:e.name,price:e.price,spec_length:e.spec.length,spec_width:e.spec.width,spec_height:e.spec.height,spec_color:e.spec.color,spec_unit:e.spec.unit||"cm",image:e.image,imageFile:null,factories:((t=e.factories)==null?void 0:t.map(a=>a.id))||[],_id:e.id},p.value=!0}function V(){f.value={name:"",price:null,spec_length:null,spec_width:null,spec_height:null,spec_unit:"cm",spec_color:"",image:"",imageFile:null,factories:[],_id:void 0}}async function q(e){let t=e.image;e.imageFile&&(t=await ue(e.imageFile));const a=B.filter(s=>{var l;return(l=e.factories)==null?void 0:l.includes(s.value)}).map(s=>({id:s.value,name:s.label})),r={name:e.name,price:Number(e.price),spec:JSON.stringify({length:e.spec_length,width:e.spec_width,height:e.spec_height,color:e.spec_color,unit:e.spec_unit||"cm"}),image:t,factories:a,status:"on"};if(o.value){const s={...r};delete s._id,await T(e._id,s),S.success("商品编辑成功")}else await pe(r),S.success("商品添加成功");_(),p.value=!1,V()}function w(e){A.value=[e],I.value=0,x.value=!0}return(e,t)=>{const a=$("el-button"),r=$("el-tag"),s=$("el-card");return v(),C(s,{class:"goods-card"},{default:i(()=>[m("div",null,[m("div",re,[t[5]||(t[5]=m("h1",null,"商品管理",-1)),n(a,{type:"primary",onClick:Y},{default:i(()=>t[4]||(t[4]=[g("添加商品")])),_:1,__:[4]})]),n(ae,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=l=>h.value=l),fields:k,onSearch:L,onReset:U},null,8,["modelValue"]),n(ie,{goods:b.value,columns:P,onView:F,onEdit:O,onDelete:D,onFactoryClick:W},{spec:i(({row:l})=>[m("div",null,[m("div",null," 长*宽*高："+d(l.spec.length)+"*"+d(l.spec.width)+"*"+d(l.spec.height)+d((l.spec.unit||"cm")+"³"),1),m("div",null,"颜色："+d(l.spec.color),1)])]),image:i(({row:l})=>[m("img",{style:{width:"48px",height:"48px","object-fit":"cover","border-radius":"4px",border:"1px solid #eee",cursor:"pointer"},src:l.image,onClick:c=>w(l.image)},null,8,me)]),factories:i(({row:l})=>[(v(!0),X(Z,null,ee(l.factories,c=>(v(),C(r,{key:c.id,class:"factory-tag",onClick:y=>e.$emit("factory-click",c),style:{cursor:"pointer","margin-right":"4px"}},{default:i(()=>[g(d(c.name),1)]),_:2},1032,["onClick"]))),128))]),status:i(({row:l})=>[n(r,{type:l.status==="on"?"success":"info"},{default:i(()=>[g(d(l.status==="on"?"上架":"下架"),1)]),_:2},1032,["type"])]),actions:i(({row:l,$index:c})=>[n(a,{size:"small",onClick:y=>F(l)},{default:i(()=>t[6]||(t[6]=[g("查看")])),_:2,__:[6]},1032,["onClick"]),n(a,{type:"primary",size:"small",onClick:y=>E(l)},{default:i(()=>t[7]||(t[7]=[g("编辑")])),_:2,__:[7]},1032,["onClick"]),n(a,{type:l.status==="on"?"warning":"success",size:"small",onClick:y=>N(l,l.status==="on"?"off":"on")},{default:i(()=>[g(d(l.status==="on"?"下架":"上架"),1)]),_:2},1032,["type","onClick"]),n(a,{type:"danger",size:"small",onClick:y=>D(l)},{default:i(()=>t[8]||(t[8]=[g("删除")])),_:2,__:[8]},1032,["onClick"])]),_:1},8,["goods"]),n(se,{modelValue:p.value,"onUpdate:modelValue":[t[1]||(t[1]=l=>p.value=l),t[2]||(t[2]=l=>{l||V()})],title:o.value?"编辑商品":"添加商品",fields:M,formData:f.value,onSubmit:q},{image:i(({form:l})=>[n(ne,{modelValue:l.image,"onUpdate:modelValue":c=>l.image=c,onFileChange:c=>l.imageFile=c},null,8,["modelValue","onUpdate:modelValue","onFileChange"])]),_:1},8,["modelValue","title","formData"]),n(de,{"url-list":A.value,"initial-index":I.value,visible:x.value,onClose:t[3]||(t[3]=l=>x.value=!1)},null,8,["url-list","initial-index","visible"])])]),_:1})}}}),ke=le(ge,[["__scopeId","data-v-c8a12274"]]);export{ke as default};
