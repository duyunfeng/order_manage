import{d as q,r as p,o as L,S as x,G as Y,D as n,g as _,z as N,A as y,C as r,E as c,B as P,U as A,V as W,R as V,W as j,_ as G}from"./BxW7P6YO.js";import{B as H,a as Z}from"./DmTcGZZt.js";import{B as J}from"./DTLkWoKO.js";import{_ as K}from"./Bl7Kk6Fe.js";const O={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"16px"}},Q=q({__name:"index",setup(X){const m=p({id:"",username:"",status:"",registeredAt:""}),B=[{prop:"id",label:"用户ID",placeholder:"请输入用户ID",type:"input"},{prop:"username",label:"用户名",placeholder:"请输入用户名",type:"input"},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"全部",value:""},{label:"正常",value:"active"},{label:"禁用",value:"inactive"}]},{prop:"registeredAt",label:"注册时间",type:"date",placeholder:"请选择注册时间",valueFormat:"YYYY-MM-DD"}],i=p(!1),v=p(!1),f=p({username:"",name:"",role:"",email:"",avatar:"",avatarFile:null,status:"active",_id:void 0}),C=[{prop:"username",label:"用户名",type:"input",placeholder:"请输入用户名",rules:[{required:!0,message:"必填"},{validator:z,trigger:"blur"}]},{prop:"name",label:"昵称",type:"input",placeholder:"请输入昵称",rules:[{required:!0,message:"必填"}]},{prop:"role",label:"角色",type:"input",placeholder:"请输入角色",rules:[{required:!0,message:"必填"}]},{prop:"email",label:"邮箱",type:"input",placeholder:"请输入邮箱"},{prop:"avatar",label:"头像",type:"custom-upload",placeholder:"请上传头像"},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"正常",value:"active"},{label:"禁用",value:"inactive"}],rules:[{required:!0,message:"必填"}]}],E=[{prop:"id",label:"用户ID",width:200},{prop:"username",label:"用户名",width:120},{prop:"name",label:"昵称",width:120},{prop:"role",label:"角色",width:100},{prop:"email",label:"邮箱",width:180},{prop:"status",label:"状态",width:100,slot:!0},{prop:"createdAt",label:"创建时间",width:160},{prop:"updatedAt",label:"更新时间",width:160},{prop:"actions",label:"操作",minWidth:180,slot:!0}],g=p([]);L(u);async function u(){const t=await x(m.value);g.value=(t.data.data||t).map(e=>({...e,createdAt:e.createdAt||"",updatedAt:e.updatedAt||""}))}function R(t){u().then(()=>{g.value=g.value.filter(e=>{const l=!t.id||e.id.includes(t.id),s=!t.username||e.username.includes(t.username),o=!t.status||e.status===t.status,a=!t.registeredAt||e.registeredAt.startsWith(t.registeredAt);return l&&s&&o&&a})})}function S(){m.value={id:"",username:"",status:"",registeredAt:""},u()}function $(){v.value=!1,b(),i.value=!0}function M(t){v.value=!0,f.value={...t,_id:t.id,avatarFile:null},i.value=!0}function b(){f.value={username:"",name:"",role:"",email:"",avatar:"",avatarFile:null,status:"active",_id:void 0}}async function T(t){let e=t.avatar;t.avatarFile&&(e=await I(t.avatarFile));const l={...t,avatar:e};if(delete l._id,v.value)await A(t._id,l);else{const s=F();await W({...l,password:s}),U(s,"用户添加成功，初始密码为：")}u(),i.value=!1,b()}function w(t){M(t)}function D(t){V.confirm(`确定要删除用户：${t.username} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{j(t.id).then(()=>{u()})})}function F(t=10){const e="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";let l="";for(let s=0;s<t;s++)l+=e.charAt(Math.floor(Math.random()*e.length));return l}async function k(t){const e=F();await A(t.id,{password:e}),U(e)}async function z(t,e,l){if(!e)return l(new Error("用户名不能为空"));if(!new RegExp("^(?!-)(?!.*--)[a-zA-Z0-9-]{1,39}(?<!-)$").test(e))return l(new Error('用户名仅支持字母、数字、单个"-",不能以"-"开头/结尾，不能连续"-",长度1-39'));const o=await x({username:e});if(o.data.data&&o.data.data.length>0){const a=f.value._id;if(o.data.data.find(h=>h.id!==a))return l(new Error("用户名已存在"))}l()}function U(t,e="密码已重置，新的初始密码为："){return V.alert(`${e}<b style="color:#409EFF">${t}</b>，请妥善保存！`,"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"知道了"})}async function I(t){return URL.createObjectURL(t)}return(t,e)=>{const l=_("el-button"),s=_("el-tag"),o=_("el-card");return N(),Y(o,{class:"user-card"},{default:n(()=>[y("div",null,[y("div",O,[e[4]||(e[4]=y("h1",null,"用户管理",-1)),r(l,{type:"primary",onClick:$},{default:n(()=>e[3]||(e[3]=[c("添加用户")])),_:1,__:[3]})]),r(H,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),fields:B,onSearch:R,onReset:S},null,8,["modelValue"]),r(Z,{goods:g.value,columns:E,onEdit:w,onDelete:D},{actions:n(({row:a,$index:d})=>[r(l,{type:"primary",size:"small",onClick:h=>w(a)},{default:n(()=>e[5]||(e[5]=[c("编辑")])),_:2,__:[5]},1032,["onClick"]),r(l,{type:"danger",size:"small",onClick:h=>D(a)},{default:n(()=>e[6]||(e[6]=[c("删除")])),_:2,__:[6]},1032,["onClick"]),r(l,{type:"warning",size:"small",onClick:h=>k(a)},{default:n(()=>e[7]||(e[7]=[c("重置密码")])),_:2,__:[7]},1032,["onClick"])]),status:n(({row:a})=>[r(s,{type:a.status==="active"?"success":"info"},{default:n(()=>[c(P(a.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1},8,["goods"]),r(J,{modelValue:i.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>i.value=a),e[2]||(e[2]=a=>{a||b()})],title:v.value?"编辑用户":"添加用户",fields:C,formData:f.value,onSubmit:T},{avatar:n(({form:a})=>[r(K,{modelValue:a.avatar,"onUpdate:modelValue":d=>a.avatar=d,onFileChange:d=>a.avatarFile=d},null,8,["modelValue","onUpdate:modelValue","onFileChange"])]),_:1},8,["modelValue","title","formData"])])]),_:1})}}}),se=G(Q,[["__scopeId","data-v-0e9111e0"]]);export{se as default};
