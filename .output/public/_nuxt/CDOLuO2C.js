import{d as M,H as T,r as c,Z as P,o as N,y as _,C as o,D as r,P as $,$ as z,g as i,z as w,A as n,B as m,E as h,M as g,_ as O}from"./BxW7P6YO.js";import{_ as A}from"./Bl7Kk6Fe.js";import{u as H}from"./C0__V_YE.js";import{B as F}from"./DTLkWoKO.js";const I={style:{display:"flex","align-items":"center"}},R=["src"],Z={key:1,class:"el-icon-user"},G={style:{"margin-top":"24px"}},J=M({__name:"index",setup(K){const x={active:"正常",inactive:"禁用"},v=T(),t=c({id:"",username:"",role:"",email:"",status:"",avatar:""}),d=c(!1),p=c(!1),u=P({username:"",role:"",email:"",status:"",avatar:"",avatarFile:null}),l=P({oldPwd:"",newPwd:"",confirmPwd:""}),V=c(),C=[{prop:"avatar",label:"头像",type:"custom-upload",placeholder:"请上传头像"},{prop:"username",label:"用户名",type:"input",placeholder:"请输入用户名",rules:[{required:!0,message:"必填"}]},{prop:"role",label:"角色",type:"input",placeholder:"请输入角色",rules:[{required:!0,message:"必填"}]},{prop:"email",label:"邮箱",type:"input",placeholder:"请输入邮箱"},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"正常",value:"active"},{label:"禁用",value:"inactive"}],rules:[{required:!0,message:"必填"}]}],U=[{prop:"oldPwd",label:"原密码",type:"input",placeholder:"请输入原密码",inputType:"password",rules:[{required:!0,message:"请输入原密码",trigger:"blur"}]},{prop:"newPwd",label:"新密码",type:"input",placeholder:"请输入新密码",inputType:"password",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]},{prop:"confirmPwd",label:"确认新密码",type:"input",placeholder:"请确认新密码",inputType:"password",rules:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e)=>e===l.newPwd,message:"两次输入密码不一致",trigger:"blur"}]}];async function y(){const a=await z(v.user.id);console.log(a.data.data),Object.assign(t.value,a.data.data||a),console.log(t)}N(y);function D(){Object.assign(u,t.value),d.value=!0}function k(){const a=async()=>{const e={...u};delete e.avatarFile,v.updateProfile(e).then(()=>{d.value=!1,g.success("资料修改成功"),y()})};u.avatarFile?H(u.avatarFile).then(e=>{u.avatar=e,a()}):a()}function q(){V.value.validate(async a=>{if(a){if(l.newPwd!==l.confirmPwd){g.error("两次输入密码不一致");return}await v.changePassword(l.oldPwd,l.newPwd),p.value=!1,g.success("密码修改成功"),l.oldPwd=l.newPwd=l.confirmPwd=""}})}return(a,e)=>{const B=i("el-avatar"),b=i("el-button"),E=i("el-card"),S=i("el-col"),j=i("el-row");return w(),_($,null,[o(j,{justify:"center",style:{"margin-top":"40px"}},{default:r(()=>[o(S,{span:12},{default:r(()=>[o(E,{class:"profile-card"},{default:r(()=>[n("div",I,[o(B,{size:64,style:{"margin-right":"24px"}},{default:r(()=>[t.value.avatar?(w(),_("img",{key:0,src:t.value.avatar,style:{width:"64px",height:"64px","object-fit":"cover"}},null,8,R)):(w(),_("i",Z))]),_:1}),n("div",null,[n("h2",null,m(t.value.username),1),n("p",null,"角色："+m(t.value.role),1),n("p",null,"邮箱："+m(t.value.email),1),n("p",null,"状态："+m(x[t.value.status]),1)])]),n("div",G,[o(b,{type:"primary",onClick:D},{default:r(()=>e[3]||(e[3]=[h("编辑资料")])),_:1,__:[3]}),o(b,{type:"warning",onClick:e[0]||(e[0]=s=>p.value=!0),style:{"margin-left":"16px"}},{default:r(()=>e[4]||(e[4]=[h("修改密码")])),_:1,__:[4]})])]),_:1})]),_:1})]),_:1}),o(F,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),title:"编辑资料",fields:C,formData:u,onSubmit:k},{avatar:r(({form:s})=>[o(A,{modelValue:s.avatar,"onUpdate:modelValue":f=>s.avatar=f,onFileChange:f=>s.avatarFile=f},null,8,["modelValue","onUpdate:modelValue","onFileChange"])]),_:1},8,["modelValue","formData"]),o(F,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),title:"修改密码",fields:U,formData:l,onSubmit:q},null,8,["modelValue","formData"])],64)}}}),Y=O(J,[["__scopeId","data-v-d591b9af"]]);export{Y as default};
