import{B as ie,a as re}from"./DmTcGZZt.js";import{B as ue}from"./DTLkWoKO.js";import{B as de}from"./32st1eI5.js";import{d as ce,r,k as R,o as pe,e as me,R as N,G as y,D as n,g as v,z as s,A as f,C as i,E as p,N as U,y as d,P as q,Q as E,B as Y,J as M,X as ve,Y as fe,_ as _e}from"./BxW7P6YO.js";import{g as ge,u as ye,a as we,d as be}from"./BsEFi5Ql.js";import{g as he}from"./CoxSq_4e.js";import{g as Ce}from"./CkUg4rBD.js";const ke={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"16px"}},xe={key:2},Ue={key:0,style:{"margin-left":"8px",color:"#67c23a"}},De={class:"preview-dialog-flex"},Fe={class:"preview-dialog-body-full"},Le=["src"],Ve={key:1,class:"preview-empty-tip"},Ae={key:0,class:"preview-dialog-footer"},Be=ce({__name:"index",setup($e,{expose:T}){const D=r({id:"",customer:"",status:"",createdAt:""}),z=[{prop:"id",label:"订单ID",placeholder:"请输入订单ID",type:"input"},{prop:"customer",label:"客户",placeholder:"请输入客户名",type:"input"},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"全部",value:""},{label:"已支付",value:"已支付"},{label:"待支付",value:"待支付"}]},{prop:"createdAt",label:"创建时间",type:"date",placeholder:"请选择创建时间",valueFormat:"YYYY-MM-DD"}],_=r(!1),w=r(!1),F=r({customer:"",goodsList:[{name:"",quantity:1}],amount:null,status:"待支付",shippingDate:"",contractUrl:"",contractFileList:[],_id:void 0}),b=r([]),h=r(!1),C=r(""),k=r(""),S=r([]),x=r([]),P=r("");R(()=>P.value?x.value.filter(t=>t.name.includes(P.value)):x.value);async function G(){const t=await he();S.value=(t.data.data||[]).filter(e=>e.status==="正常")}async function W(){const t=await Ce();x.value=t.data.data||t}pe(()=>{g(),G(),W(),window.__vuePreviewContractFile=V,window.__vueDownloadContractFile=A}),me(()=>{delete window.__vuePreviewContractFile,delete window.__vueDownloadContractFile});async function g(){const t=await ge();b.value=(t.data.data||t).map(e=>({...e,createdAt:e.createdAt||"",updatedAt:e.updatedAt||""}))}function j(t){g().then(()=>{b.value=b.value.filter(e=>{const l=!t.id||e.id.includes(t.id),c=!t.customer||e.customer.includes(t.customer),B=!t.status||e.status===t.status,$=!t.createdAt||e.createdAt.startsWith(t.createdAt);return l&&c&&B&&$})})}function J(){D.value={id:"",customer:"",status:"",createdAt:""},g()}function K(t,e,l,c){c.contractUrl=t.data.url,c.contractFileList=[{name:e.name,url:t.url,status:"success"}]}function Q(t,e){V(t.url)}function X(t,e,l){l.contractUrl="",l.contractFileList=[]}function H(){w.value=!1,L(),_.value=!0}function Z(t){w.value=!0,F.value={...t,_id:t.id,contractFileList:t.contractUrl?[{name:"合同文件",url:t.contractUrl,status:"success"}]:[]},_.value=!0}function L(){F.value={customer:"",goodsList:[{name:"",quantity:1}],amount:null,status:"待支付",shippingDate:"",contractUrl:"",contractFileList:[],_id:void 0}}async function ee(t){const e={...t};delete e._id,w.value?await ye(t._id,e):await we(e),g(),_.value=!1,L()}function O(t){Z(t)}function I(t){N.confirm(`确定要删除订单：${t.id} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{be(t.id).then(()=>{g()})})}function V(t){console.log(t);const e=te(t);if(!e){N.alert("暂不支持预览该类型文件，请下载后查看","提示"),C.value="",h.value=!0,k.value=t;return}C.value=e,h.value=!0,k.value=t}function te(t){var c;if(!t)return"";const e=(c=t.split(".").pop())==null?void 0:c.toLowerCase();return e==="pdf"?t:["doc","docx","xls","xlsx","ppt","pptx"].includes(e)?`https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(t)}`:""}function A(t){const e=document.createElement("a");e.href=t,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}const oe=R(()=>[{prop:"customer",label:"客户",type:"select",placeholder:"请选择客户",options:S.value.map(t=>({label:t.name,value:t.name})),rules:[{required:!0,message:"必填"}]},{prop:"goodsList",label:"商品列表",type:"goods-list"},{prop:"amount",label:"金额",type:"input",placeholder:"请输入金额",rules:[{required:!0,message:"必填"}]},{prop:"status",label:"状态",type:"select",placeholder:"请选择状态",options:[{label:"已支付",value:"已支付"},{label:"待支付",value:"待支付"}],rules:[{required:!0,message:"必填"}]},{prop:"shippingDate",label:"船期",type:"date",placeholder:"请选择船期",rules:[{required:!0,message:"必填"}]},{prop:"contractUrl",label:"合同文件",type:"custom-upload"}]),le=[{prop:"id",label:"订单ID",width:200},{prop:"customer",label:"客户",width:120},{prop:"goodsList",label:"商品列表",minWidth:200,slot:!0},{prop:"amount",label:"金额",width:100},{prop:"status",label:"状态",width:100,slot:!0},{prop:"shippingDate",label:"船期",width:120},{prop:"contractUrl",label:"合同预览",width:160,slot:!0,getSlot:t=>t.contractUrl?`<span class='contract-actions'>
            <button class='el-button el-button--text' onclick='window.__vuePreviewContractFile && window.__vuePreviewContractFile("${t.contractUrl}")'>预览</button>
            <button class='el-button el-button--text' onclick='window.__vueDownloadContractFile && window.__vueDownloadContractFile("${t.contractUrl}")'>下载</button>
          </span>`:"无"},{prop:"createdAt",label:"创建时间",width:160},{prop:"updatedAt",label:"更新时间",width:160},{prop:"actions",label:"操作",minWidth:180,slot:!0,actions:de,getActions:(t,e)=>[{label:"编辑",type:"primary",onClick:l=>O(l)},{label:"删除",type:"danger",onClick:l=>I(l)}]}];return T({handleContractPreview:Q,handleContractRemove:X}),(t,e)=>{const l=v("el-button"),c=v("el-option"),B=v("el-select"),$=v("el-input-number"),ae=v("el-upload"),ne=v("el-dialog"),se=v("el-card");return s(),y(se,{class:"order-card"},{default:n(()=>[f("div",null,[f("div",ke,[e[6]||(e[6]=f("h1",null,"订单管理",-1)),i(l,{type:"primary",onClick:H},{default:n(()=>e[5]||(e[5]=[p("添加订单")])),_:1,__:[5]})]),i(ie,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=o=>D.value=o),fields:z,onSearch:j,onReset:J},null,8,["modelValue"]),i(re,{goods:b.value,columns:le},{goodsList:n(({row:o})=>[f("div",null,[(s(!0),d(q,null,E(o.goodsList,a=>(s(),d("span",{key:a.name,style:{"margin-right":"8px"}},Y(a.name)+" x"+Y(a.quantity),1))),128))])]),contractUrl:n(({row:o})=>[o.contractUrl?(s(),y(l,{key:0,type:"primary",link:"",onClick:a=>V(o.contractUrl)},{default:n(()=>e[7]||(e[7]=[p("预览")])),_:2,__:[7]},1032,["onClick"])):U("",!0),o.contractUrl?(s(),y(l,{key:1,type:"danger",link:"",onClick:a=>A(o.contractUrl)},{default:n(()=>e[8]||(e[8]=[p("下载")])),_:2,__:[8]},1032,["onClick"])):(s(),d("span",xe,"无"))]),actions:n(({row:o,$index:a})=>[i(l,{type:"primary",size:"small",onClick:m=>O(o)},{default:n(()=>e[9]||(e[9]=[p("编辑")])),_:2,__:[9]},1032,["onClick"]),i(l,{type:"danger",size:"small",onClick:m=>I(o)},{default:n(()=>e[10]||(e[10]=[p("删除")])),_:2,__:[10]},1032,["onClick"])]),_:1},8,["goods"]),i(ue,{modelValue:_.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>_.value=o),e[2]||(e[2]=o=>{o||L()})],title:w.value?"编辑订单":"添加订单",fields:oe.value,formData:F.value,onSubmit:ee},{goodsList:n(({form:o})=>[(s(!0),d(q,null,E(o.goodsList,(a,m)=>(s(),d("div",{key:m,style:{display:"flex","align-items":"center","margin-bottom":"8px"}},[i(B,{modelValue:a.name,"onUpdate:modelValue":u=>a.name=u,placeholder:"请选择商品",style:{width:"160px","margin-right":"8px"}},{default:n(()=>[(s(!0),d(q,null,E(x.value,u=>(s(),y(c,{key:u.name,label:u.name,value:u.name},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),i($,{modelValue:a.quantity,"onUpdate:modelValue":u=>a.quantity=u,min:1,style:{width:"100px","margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),o.goodsList.length>1?(s(),y(l,{key:0,type:"danger",icon:M(ve),onClick:u=>o.goodsList.splice(m,1)},{default:n(()=>e[11]||(e[11]=[p(" 删除 ")])),_:2,__:[11]},1032,["icon","onClick"])):U("",!0)]))),128)),i(l,{type:"primary",plain:"",icon:M(fe),onClick:a=>o.goodsList.push({name:"",quantity:1})},{default:n(()=>e[12]||(e[12]=[p("添加商品")])),_:2,__:[12]},1032,["icon","onClick"])]),contractUrl:n(({form:o})=>[i(ae,{"file-list":o.contractFileList,"show-file-list":!0,"on-success":(a,m,u)=>K(a,m,u,o),"on-preview":a=>t.$options.handleContractPreview(a,o),"before-remove":(a,m)=>t.$options.handleContractRemove(a,m,o),"auto-upload":!0,limit:1,action:"/api/upload",accept:"application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{default:n(()=>[i(l,{type:"primary"},{default:n(()=>e[13]||(e[13]=[p("上传合同")])),_:1,__:[13]}),o.contractFileList&&o.contractFileList.length?(s(),d("span",Ue,"已上传")):U("",!0)]),_:2},1032,["file-list","on-success","on-preview","before-remove"])]),_:1},8,["modelValue","title","fields","formData"]),i(ne,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=o=>h.value=o),title:"合同预览",width:"80vw",top:"5vh","custom-class":"preview-dialog"},{default:n(()=>[f("div",De,[f("div",Fe,[C.value?(s(),d("iframe",{key:0,src:C.value,class:"preview-iframe-full"},null,8,Le)):(s(),d("div",Ve,"暂不支持预览该类型文件，请下载后查看"))]),k.value?(s(),d("div",Ae,[i(l,{type:"primary",onClick:e[3]||(e[3]=o=>A(k.value))},{default:n(()=>e[14]||(e[14]=[p("下载文件")])),_:1,__:[14]})])):U("",!0)])]),_:1},8,["modelValue"])])]),_:1})}}}),Ne=_e(Be,[["__scopeId","data-v-0c2c1998"]]);export{Ne as default};
